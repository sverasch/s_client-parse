# Copyright 2019 Simon E Vera-Schockner
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import unittest
import distance
from x509 import X509CertInfo, X509Zcertificate

cert_binary_string = b"""-----BEGIN CERTIFICATE-----
MIIHQjCCBiqgAwIBAgIQCgYwQn9bvO1pVzllk7ZFHzANBgkqhkiG9w0BAQsFADB1
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMTQwMgYDVQQDEytEaWdpQ2VydCBTSEEyIEV4dGVuZGVk
IFZhbGlkYXRpb24gU2VydmVyIENBMB4XDTE4MDUwODAwMDAwMFoXDTIwMDYwMzEy
MDAwMFowgccxHTAbBgNVBA8MFFByaXZhdGUgT3JnYW5pemF0aW9uMRMwEQYLKwYB
BAGCNzwCAQMTAlVTMRkwFwYLKwYBBAGCNzwCAQITCERlbGF3YXJlMRAwDgYDVQQF
Ewc1MTU3NTUwMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQG
A1UEBxMNU2FuIEZyYW5jaXNjbzEVMBMGA1UEChMMR2l0SHViLCBJbmMuMRMwEQYD
VQQDEwpnaXRodWIuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
xjyq8jyXDDrBTyitcnB90865tWBzpHSbindG/XqYQkzFMBlXmqkzC+FdTRBYyneZ
w5Pz+XWQvL+74JW6LsWNc2EF0xCEqLOJuC9zjPAqbr7uroNLghGxYf13YdqbG5oj
/4x+ogEG3dF/U5YIwVr658DKyESMV6eoYV9mDVfTuJastkqcwero+5ZAKfYVMLUE
sMwFtoTDJFmVf6JlkOWwsxp1WcQ/MRQK1cyqOoUFUgYylgdh3yeCDPeF22Ax8AlQ
xbcaI+GwfQL1FB7Jy+h+KjME9lE/UpgV6Qt2R1xNSmvFCBWu+NFX6epwFP/JRbkM
fLz0beYFUvmMgLtwVpEPSwIDAQABo4IDeTCCA3UwHwYDVR0jBBgwFoAUPdNQpdag
re7zSmAKZdMh1Pj41g8wHQYDVR0OBBYEFMnCU2FmnV+rJfQmzQ84mqhJ6kipMCUG
A1UdEQQeMByCCmdpdGh1Yi5jb22CDnd3dy5naXRodWIuY29tMA4GA1UdDwEB/wQE
AwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwdQYDVR0fBG4wbDA0
oDKgMIYuaHR0cDovL2NybDMuZGlnaWNlcnQuY29tL3NoYTItZXYtc2VydmVyLWcy
LmNybDA0oDKgMIYuaHR0cDovL2NybDQuZGlnaWNlcnQuY29tL3NoYTItZXYtc2Vy
dmVyLWcyLmNybDBLBgNVHSAERDBCMDcGCWCGSAGG/WwCATAqMCgGCCsGAQUFBwIB
FhxodHRwczovL3d3dy5kaWdpY2VydC5jb20vQ1BTMAcGBWeBDAEBMIGIBggrBgEF
BQcBAQR8MHowJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBS
BggrBgEFBQcwAoZGaHR0cDovL2NhY2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0
U0hBMkV4dGVuZGVkVmFsaWRhdGlvblNlcnZlckNBLmNydDAMBgNVHRMBAf8EAjAA
MIIBfgYKKwYBBAHWeQIEAgSCAW4EggFqAWgAdgCkuQmQtBhYFIe7E6LMZ3AKPDWY
BPkb37jjd80OyA3cEAAAAWNBYm0KAAAEAwBHMEUCIQDRZp38cTWsWH2GdBpe/uPT
Wnsu/m4BEC2+dIcvSykZYgIgCP5gGv6yzaazxBK2NwGdmmyuEFNSg2pARbMJlUFg
U5UAdgBWFAaaL9fC7NP14b1Esj7HRna5vJkRXMDvlJhV1onQ3QAAAWNBYm0tAAAE
AwBHMEUCIQCi7omUvYLm0b2LobtEeRAYnlIo7n6JxbYdrtYdmPUWJQIgVgw1AZ51
vK9ENinBg22FPxb82TvNDO05T17hxXRC2IYAdgC72d+8H4pxtZOUI5eqkntHOFeV
CqtS6BqQlmQ2jh7RhQAAAWNBYm3fAAAEAwBHMEUCIQChzdTKUU2N+XcqcK0OJYrN
8EYynloVxho4yPk6Dq3EPgIgdNH5u8rC3UcslQV4B9o0a0w204omDREGKTVuEpxG
eOQwDQYJKoZIhvcNAQELBQADggEBAHAPWpanWOW/ip2oJ5grAH8mqQfaunuCVE+v
ac+88lkDK/LVdFgl2B6kIHZiYClzKtfczG93hWvKbST4NRNHP9LiaQqdNC17e5vN
HnXVUGw+yxyjMLGqkgepOnZ2Rb14kcTOGp4i5AuJuuaMwXmCo7jUwPwfLe1NUlVB
Kqg6LK0Hcq4K0sZnxE8HFxiZ92WpV2AVWjRMEc/2z2shNoDvxvFUYyY1Oe67xINk
myQKc+ygSBZzyLnXSFVWmHr3u5dcaaQGGAR42v6Ydr4iL38Hd4dOiBma+FXsXBIq
WUjbST4VXmdaol7uzFMojA4zkxQDZAvF5XgJlAFadfySna/teik=
-----END CERTIFICATE-----
"""

zlib_json = b'{"raw":"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","parsed":{"version":3,"serial_number":"13324412563135569597699362973539517727","signature_algorithm":{"name":"SHA256-RSA","oid":"1.2.840.113549.1.1.11"},"issuer":{"common_name":["DigiCert SHA2 Extended Validation Server CA"],"country":["US"],"organization":["DigiCert Inc"],"organizational_unit":["www.digicert.com"]},"issuer_dn":"C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert SHA2 Extended Validation Server CA","validity":{"start":"2018-05-08T00:00:00Z","end":"2020-06-03T12:00:00Z","length":65448000},"subject":{"common_name":["github.com"],"serial_number":["5157550"],"country":["US"],"locality":["San Francisco"],"province":["California"],"organization":["GitHub, Inc."],"jurisdiction_country":["US"],"jurisdiction_province":["Delaware"]},"subject_dn":"businessCategory=Private Organization, jurisdictionCountry=US, jurisdictionStateOrProvince=Delaware, serialNumber=5157550, C=US, ST=California, L=San Francisco, O=GitHub, Inc., CN=github.com","subject_key_info":{"key_algorithm":{"name":"RSA"},"rsa_public_key":{"exponent":65537,"modulus":"xjyq8jyXDDrBTyitcnB90865tWBzpHSbindG/XqYQkzFMBlXmqkzC+FdTRBYyneZw5Pz+XWQvL+74JW6LsWNc2EF0xCEqLOJuC9zjPAqbr7uroNLghGxYf13YdqbG5oj/4x+ogEG3dF/U5YIwVr658DKyESMV6eoYV9mDVfTuJastkqcwero+5ZAKfYVMLUEsMwFtoTDJFmVf6JlkOWwsxp1WcQ/MRQK1cyqOoUFUgYylgdh3yeCDPeF22Ax8AlQxbcaI+GwfQL1FB7Jy+h+KjME9lE/UpgV6Qt2R1xNSmvFCBWu+NFX6epwFP/JRbkMfLz0beYFUvmMgLtwVpEPSw==","length":2048},"fingerprint_sha256":"a39a1ae45e0b6d911f799d245c3826694d8adec20f62d6d0a53dc440b259aae3"},"extensions":{"key_usage":{"digital_signature":true,"key_encipherment":true,"value":5},"basic_constraints":{"is_ca":false},"subject_alt_name":{"dns_names":["github.com","www.github.com"]},"crl_distribution_points":["http://crl3.digicert.com/sha2-ev-server-g2.crl","http://crl4.digicert.com/sha2-ev-server-g2.crl"],"authority_key_id":"3dd350a5d6a0adeef34a600a65d321d4f8f8d60f","subject_key_id":"c9c25361669d5fab25f426cd0f389aa849ea48a9","extended_key_usage":{"server_auth":true,"client_auth":true},"certificate_policies":[{"id":"2.16.840.1.114412.2.1","cps":["https://www.digicert.com/CPS"]},{"id":"2.23.140.1.1"}],"authority_info_access":{"ocsp_urls":["http://ocsp.digicert.com"],"issuer_urls":["http://cacerts.digicert.com/DigiCertSHA2ExtendedValidationServerCA.crt"]},"signed_certificate_timestamps":[{"version":0,"log_id":"pLkJkLQYWBSHuxOizGdwCjw1mAT5G9+443fNDsgN3BA=","timestamp":1525810359,"signature":"BAMARzBFAiEA0Wad/HE1rFh9hnQaXv7j01p7Lv5uARAtvnSHL0spGWICIAj+YBr+ss2ms8QStjcBnZpsrhBTUoNqQEWzCZVBYFOV"},{"version":0,"log_id":"VhQGmi/XwuzT9eG9RLI+x0Z2ubyZEVzA75SYVdaJ0N0=","timestamp":1525810359,"signature":"BAMARzBFAiEAou6JlL2C5tG9i6G7RHkQGJ5SKO5+icW2Ha7WHZj1FiUCIFYMNQGedbyvRDYpwYNthT8W/Nk7zQztOU9e4cV0QtiG"},{"version":0,"log_id":"u9nfvB+KcbWTlCOXqpJ7RzhXlQqrUugakJZkNo4e0YU=","timestamp":1525810359,"signature":"BAMARzBFAiEAoc3UylFNjfl3KnCtDiWKzfBGMp5aFcYaOMj5Og6txD4CIHTR+bvKwt1HLJUFeAfaNGtMNtOKJg0RBik1bhKcRnjk"}]},"signature":{"signature_algorithm":{"name":"SHA256-RSA","oid":"1.2.840.113549.1.1.11"},"value":"cA9alqdY5b+KnagnmCsAfyapB9q6e4JUT69pz7zyWQMr8tV0WCXYHqQgdmJgKXMq19zMb3eFa8ptJPg1E0c/0uJpCp00LXt7m80eddVQbD7LHKMwsaqSB6k6dnZFvXiRxM4aniLkC4m65ozBeYKjuNTA/B8t7U1SVUEqqDosrQdyrgrSxmfETwcXGJn3ZalXYBVaNEwRz/bPayE2gO/G8VRjJjU57rvEg2SbJApz7KBIFnPIuddIVVaYeve7l1xppAYYBHja/ph2viIvfwd3h06IGZr4VexcEipZSNtJPhVeZ1qiXu7MUyiMDjOTFANkC8XleAmUAVp1/JKdr+16KQ==","valid":false,"self_signed":false},"fingerprint_md5":"9c81f7d7ad126a83217b35ac5dc7aa02","fingerprint_sha1":"ca06f56b258b7a0d4f2b05470939478651151984","fingerprint_sha256":"3111500c4a66012cdae333ec3fca1c9dde45c954440e7ee413716bff3663c074","tbs_noct_fingerprint":"41b3426f01a778d0b79ac39ec42e2de481c951d9c508a6552d9178a44de40447","spki_subject_fingerprint":"c2c05a1903488a24c1b2af8efc08a58851e3e06258e425853bec64cca03777ce","tbs_fingerprint":"85088f934d3e58e3673ea5be32c7c8cf6965e4ab93fbed4fff634723f46d5693","validation_level":"EV","names":["github.com","www.github.com"],"redacted":false},"zlint":{"version":3,"timestamp":1571066892,"lints":{"e_basic_constraints_not_critical":{"result":"NA"},"e_ca_common_name_missing":{"result":"NA"},"e_ca_country_name_invalid":{"result":"NA"},"e_ca_country_name_missing":{"result":"NA"},"e_ca_crl_sign_not_set":{"result":"NA"},"e_ca_is_ca":{"result":"NA"},"e_ca_key_cert_sign_not_set":{"result":"NA"},"e_ca_key_usage_missing":{"result":"NA"},"e_ca_key_usage_not_critical":{"result":"NA"},"e_ca_organization_name_missing":{"result":"NA"},"e_ca_subject_field_empty":{"result":"NA"},"e_cab_dv_conflicts_with_locality":{"result":"NA"},"e_cab_dv_conflicts_with_org":{"result":"NA"},"e_cab_dv_conflicts_with_postal":{"result":"NA"},"e_cab_dv_conflicts_with_province":{"result":"NA"},"e_cab_dv_conflicts_with_street":{"result":"NA"},"e_cab_iv_requires_personal_name":{"result":"NA"},"e_cab_ov_requires_org":{"result":"NA"},"e_cert_contains_unique_identifier":{"result":"pass"},"e_cert_extensions_version_not_3":{"result":"pass"},"e_cert_policy_iv_requires_country":{"result":"NA"},"e_cert_policy_iv_requires_province_or_locality":{"result":"NA"},"e_cert_policy_ov_requires_country":{"result":"NA"},"e_cert_policy_ov_requires_province_or_locality":{"result":"NA"},"e_cert_unique_identifier_version_not_2_or_3":{"result":"NA"},"e_distribution_point_incomplete":{"result":"pass"},"e_dnsname_bad_character_in_label":{"result":"pass"},"e_dnsname_contains_bare_iana_suffix":{"result":"pass"},"e_dnsname_empty_label":{"result":"pass"},"e_dnsname_hyphen_in_sld":{"result":"pass"},"e_dnsname_label_too_long":{"result":"pass"},"e_dnsname_left_label_wildcard_correct":{"result":"pass"},"e_dnsname_not_valid_tld":{"result":"pass"},"e_dnsname_underscore_in_sld":{"result":"pass"},"e_dnsname_wildcard_only_in_left_label":{"result":"pass"},"e_dsa_correct_order_in_subgroup":{"result":"NA"},"e_dsa_improper_modulus_or_divisor_size":{"result":"NA"},"e_dsa_params_missing":{"result":"NA"},"e_dsa_shorter_than_2048_bits":{"result":"NA"},"e_dsa_unique_correct_representation":{"result":"NA"},"e_ec_improper_curves":{"result":"NA"},"e_ev_business_category_missing":{"result":"pass"},"e_ev_country_name_missing":{"result":"pass"},"e_ev_organization_name_missing":{"result":"pass"},"e_ev_serial_number_missing":{"result":"pass"},"e_ev_valid_time_too_long":{"result":"pass"},"e_ext_aia_marked_critical":{"result":"pass"},"e_ext_authority_key_identifier_critical":{"result":"pass"},"e_ext_authority_key_identifier_missing":{"result":"pass"},"e_ext_authority_key_identifier_no_key_identifier":{"result":"pass"},"e_ext_cert_policy_disallowed_any_policy_qualifier":{"result":"pass"},"e_ext_cert_policy_duplicate":{"result":"pass"},"e_ext_cert_policy_explicit_text_ia5_string":{"result":"NA"},"e_ext_cert_policy_explicit_text_too_long":{"result":"NA"},"e_ext_duplicate_extension":{"result":"pass"},"e_ext_freshest_crl_marked_critical":{"result":"NA"},"e_ext_ian_dns_not_ia5_string":{"result":"NA"},"e_ext_ian_empty_name":{"result":"NA"},"e_ext_ian_no_entries":{"result":"NA"},"e_ext_ian_rfc822_format_invalid":{"result":"NA"},"e_ext_ian_space_dns_name":{"result":"NA"},"e_ext_ian_uri_format_invalid":{"result":"NA"},"e_ext_ian_uri_host_not_fqdn_or_ip":{"result":"NA"},"e_ext_ian_uri_not_ia5":{"result":"NA"},"e_ext_ian_uri_relative":{"result":"NA"},"e_ext_key_usage_cert_sign_without_ca":{"result":"pass"},"e_ext_key_usage_without_bits":{"result":"pass"},"e_ext_name_constraints_not_critical":{"result":"NA"},"e_ext_name_constraints_not_in_ca":{"result":"NA"},"e_ext_policy_constraints_empty":{"result":"NA"},"e_ext_policy_constraints_not_critical":{"result":"NA"},"e_ext_policy_map_any_policy":{"result":"NA"},"e_ext_san_contains_reserved_ip":{"result":"pass"},"e_ext_san_directory_name_present":{"result":"pass"},"e_ext_san_dns_name_too_long":{"result":"pass"},"e_ext_san_dns_not_ia5_string":{"result":"pass"},"e_ext_san_edi_party_name_present":{"result":"pass"},"e_ext_san_empty_name":{"result":"pass"},"e_ext_san_missing":{"result":"pass"},"e_ext_san_no_entries":{"result":"pass"},"e_ext_san_not_critical_without_subject":{"result":"pass"},"e_ext_san_other_name_present":{"result":"pass"},"e_ext_san_registered_id_present":{"result":"pass"},"e_ext_san_rfc822_format_invalid":{"result":"pass"},"e_ext_san_rfc822_name_present":{"result":"pass"},"e_ext_san_space_dns_name":{"result":"pass"},"e_ext_san_uniform_resource_identifier_present":{"result":"pass"},"e_ext_san_uri_format_invalid":{"result":"pass"},"e_ext_san_uri_host_not_fqdn_or_ip":{"result":"pass"},"e_ext_san_uri_not_ia5":{"result":"pass"},"e_ext_san_uri_relative":{"result":"pass"},"e_ext_subject_directory_attr_critical":{"result":"NA"},"e_ext_subject_key_identifier_critical":{"result":"pass"},"e_ext_subject_key_identifier_missing_ca":{"result":"NA"},"e_generalized_time_does_not_include_seconds":{"result":"NA"},"e_generalized_time_includes_fraction_seconds":{"result":"NA"},"e_generalized_time_not_in_zulu":{"result":"NA"},"e_ian_bare_wildcard":{"result":"NA"},"e_ian_dns_name_includes_null_char":{"result":"NA"},"e_ian_dns_name_starts_with_period":{"result":"NA"},"e_ian_wildcard_not_first":{"result":"NA"},"e_inhibit_any_policy_not_critical":{"result":"NA"},"e_international_dns_name_not_nfc":{"result":"pass"},"e_international_dns_name_not_unicode":{"result":"pass"},"e_invalid_certificate_version":{"result":"pass"},"e_issuer_dn_country_not_printable_string":{"result":"pass"},"e_issuer_field_empty":{"result":"pass"},"e_name_constraint_empty":{"result":"NA"},"e_name_constraint_maximum_not_absent":{"result":"NA"},"e_name_constraint_minimum_non_zero":{"result":"NA"},"e_old_root_ca_rsa_mod_less_than_2048_bits":{"result":"NA"},"e_old_sub_ca_rsa_mod_less_than_1024_bits":{"result":"NA"},"e_old_sub_cert_rsa_mod_less_than_1024_bits":{"result":"NA"},"e_path_len_constraint_improperly_included":{"result":"pass"},"e_path_len_constraint_zero_or_less":{"result":"pass"},"e_public_key_type_not_allowed":{"result":"pass"},"e_root_ca_extended_key_usage_present":{"result":"NA"},"e_root_ca_key_usage_must_be_critical":{"result":"NA"},"e_root_ca_key_usage_present":{"result":"NA"},"e_rsa_exp_negative":{"result":"pass"},"e_rsa_mod_less_than_2048_bits":{"result":"pass"},"e_rsa_no_public_key":{"result":"pass"},"e_rsa_public_exponent_not_odd":{"result":"pass"},"e_rsa_public_exponent_too_small":{"result":"pass"},"e_san_bare_wildcard":{"result":"pass"},"e_san_dns_name_includes_null_char":{"result":"pass"},"e_san_dns_name_starts_with_period":{"result":"pass"},"e_san_wildcard_not_first":{"result":"pass"},"e_serial_number_longer_than_20_octets":{"result":"pass"},"e_serial_number_not_positive":{"result":"pass"},"e_signature_algorithm_not_supported":{"result":"pass"},"e_sub_ca_aia_does_not_contain_ocsp_url":{"result":"NA"},"e_sub_ca_aia_marked_critical":{"result":"NA"},"e_sub_ca_aia_missing":{"result":"NA"},"e_sub_ca_certificate_policies_missing":{"result":"NA"},"e_sub_ca_crl_distribution_points_does_not_contain_url":{"result":"NA"},"e_sub_ca_crl_distribution_points_marked_critical":{"result":"NA"},"e_sub_ca_crl_distribution_points_missing":{"result":"NA"},"e_sub_cert_aia_does_not_contain_ocsp_url":{"result":"pass"},"e_sub_cert_aia_marked_critical":{"result":"pass"},"e_sub_cert_aia_missing":{"result":"pass"},"e_sub_cert_cert_policy_empty":{"result":"pass"},"e_sub_cert_certificate_policies_missing":{"result":"pass"},"e_sub_cert_country_name_must_appear":{"result":"pass"},"e_sub_cert_crl_distribution_points_does_not_contain_url":{"result":"pass"},"e_sub_cert_crl_distribution_points_marked_critical":{"result":"pass"},"e_sub_cert_eku_missing":{"result":"pass"},"e_sub_cert_eku_server_auth_client_auth_missing":{"result":"pass"},"e_sub_cert_given_name_surname_contains_correct_policy":{"result":"NA"},"e_sub_cert_key_usage_cert_sign_bit_set":{"result":"pass"},"e_sub_cert_key_usage_crl_sign_bit_set":{"result":"pass"},"e_sub_cert_locality_name_must_appear":{"result":"pass"},"e_sub_cert_locality_name_must_not_appear":{"result":"pass"},"e_sub_cert_not_is_ca":{"result":"pass"},"e_sub_cert_or_sub_ca_using_sha1":{"result":"pass"},"e_sub_cert_postal_code_must_not_appear":{"result":"pass"},"e_sub_cert_province_must_appear":{"result":"pass"},"e_sub_cert_province_must_not_appear":{"result":"pass"},"e_sub_cert_street_address_should_not_exist":{"result":"pass"},"e_sub_cert_valid_time_longer_than_39_months":{"result":"pass"},"e_sub_cert_valid_time_longer_than_825_days":{"result":"pass"},"e_subject_common_name_max_length":{"result":"pass"},"e_subject_common_name_not_from_san":{"result":"pass"},"e_subject_contains_noninformational_value":{"result":"pass"},"e_subject_contains_reserved_ip":{"result":"pass"},"e_subject_country_not_iso":{"result":"pass"},"e_subject_dn_country_not_printable_string":{"result":"pass"},"e_subject_dn_serial_number_max_length":{"result":"pass"},"e_subject_dn_serial_number_not_printable_string":{"result":"pass"},"e_subject_email_max_length":{"result":"pass"},"e_subject_empty_without_san":{"result":"pass"},"e_subject_given_name_max_length":{"result":"pass"},"e_subject_info_access_marked_critical":{"result":"NA"},"e_subject_locality_name_max_length":{"result":"pass"},"e_subject_not_dn":{"result":"pass"},"e_subject_organization_name_max_length":{"result":"pass"},"e_subject_organizational_unit_name_max_length":{"result":"pass"},"e_subject_postal_code_max_length":{"result":"pass"},"e_subject_state_name_max_length":{"result":"pass"},"e_subject_street_address_max_length":{"result":"pass"},"e_subject_surname_max_length":{"result":"pass"},"e_utc_time_does_not_include_seconds":{"result":"pass"},"e_utc_time_not_in_zulu":{"result":"pass"},"e_validity_time_not_positive":{"result":"pass"},"e_wrong_time_format_pre2050":{"result":"pass"},"n_ca_digital_signature_not_set":{"result":"NA"},"n_contains_redacted_dnsname":{"result":"pass"},"n_multiple_subject_rdn":{"result":"pass"},"n_sub_ca_eku_missing":{"result":"NA"},"n_sub_ca_eku_not_technically_constrained":{"result":"NA"},"n_subject_common_name_included":{"result":"info"},"w_distribution_point_missing_ldap_or_uri":{"result":"pass"},"w_dnsname_underscore_in_trd":{"result":"pass"},"w_dnsname_wildcard_left_of_public_suffix":{"result":"pass"},"w_eku_critical_improperly":{"result":"pass"},"w_ext_aia_access_location_missing":{"result":"pass"},"w_ext_cert_policy_contains_noticeref":{"result":"pass"},"w_ext_cert_policy_explicit_text_includes_control":{"result":"NA"},"w_ext_cert_policy_explicit_text_not_nfc":{"result":"NA"},"w_ext_cert_policy_explicit_text_not_utf8":{"result":"NA"},"w_ext_crl_distribution_marked_critical":{"result":"pass"},"w_ext_ian_critical":{"result":"NA"},"w_ext_key_usage_not_critical":{"result":"pass"},"w_ext_policy_map_not_critical":{"result":"NA"},"w_ext_policy_map_not_in_cert_policy":{"result":"NA"},"w_ext_san_critical_with_subject_dn":{"result":"pass"},"w_ext_subject_key_identifier_missing_sub_cert":{"result":"pass"},"w_ian_iana_pub_suffix_empty":{"result":"NA"},"w_issuer_dn_leading_whitespace":{"result":"pass"},"w_issuer_dn_trailing_whitespace":{"result":"pass"},"w_multiple_issuer_rdn":{"result":"pass"},"w_name_constraint_on_edi_party_name":{"result":"NA"},"w_name_constraint_on_registered_id":{"result":"NA"},"w_name_constraint_on_x400":{"result":"NA"},"w_root_ca_basic_constraints_path_len_constraint_field_present":{"result":"NA"},"w_root_ca_contains_cert_policy":{"result":"NA"},"w_rsa_mod_factors_smaller_than_752":{"result":"pass"},"w_rsa_mod_not_odd":{"result":"pass"},"w_rsa_public_exponent_not_in_range":{"result":"pass"},"w_san_iana_pub_suffix_empty":{"result":"pass"},"w_serial_number_low_entropy":{"result":"pass"},"w_sub_ca_aia_does_not_contain_issuing_ca_url":{"result":"NA"},"w_sub_ca_certificate_policies_marked_critical":{"result":"NA"},"w_sub_ca_eku_critical":{"result":"NA"},"w_sub_ca_name_constraints_not_critical":{"result":"NA"},"w_sub_cert_aia_does_not_contain_issuing_ca_url":{"result":"pass"},"w_sub_cert_certificate_policies_marked_critical":{"result":"pass"},"w_sub_cert_eku_extra_values":{"result":"pass"},"w_sub_cert_sha1_expiration_too_long":{"result":"NA"},"w_subject_dn_leading_whitespace":{"result":"pass"},"w_subject_dn_trailing_whitespace":{"result":"pass"}},"notices_present":true,"warnings_present":false,"errors_present":false,"fatals_present":false}}\n'

class TestX509CertInfo(unittest.TestCase):

    def test_X509CertInfo(self):
        cert_obj = X509CertInfo(cert_binary_string)

    def test_parse_attributes(self):
        cert_obj = X509CertInfo(cert_binary_string)
        issuer = cert_obj.get_issuer()

    def test_get_loaded_cert(self):
        cert_obj = X509CertInfo(cert_binary_string)
        loaded_cert = cert_obj.get_loaded_cert()

    def test_get_version(self):
        cert_obj = X509CertInfo(cert_binary_string)
        self.assertEqual(cert_obj.get_version(), 'v3')

    def test_to_json(self):
        cert_obj = X509CertInfo(cert_binary_string)
        cert_obj.parse()
        json_out = cert_obj.to_pretty_json()

class X509Zcertificate_test(unittest.TestCase):
    def test_parser(self):
        parser = X509Zcertificate(cert_binary_string)
        parser.parse()
        json_out = parser.to_json()
        # the timestamps will always be different so the sting should be mostly the same
        strdistance = distance.hamming(json_out, zlib_json)
        self.assertLessEqual(strdistance, 6)

if __name__ == '__main__':
    unittest.main()
